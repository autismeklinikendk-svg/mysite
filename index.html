<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dinfar Brew Calc</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<style>
:root {
  --accent: #c41e3a;
  --glass: rgba(0,0,0,0.65);
  --border: rgba(255,255,255,0.08);
}

* {
  box-sizing: border-box;
  font-family: Inter, system-ui, -apple-system, sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background:
    linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)),
    url("https://images7.alphacoders.com/398/398372.jpg") center / cover no-repeat fixed;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}

.panel {
  width: 100%;
  max-width: 1200px;
  background: var(--glass);
  backdrop-filter: blur(14px);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 40px 90px rgba(0,0,0,0.7);
  display: flex;
  flex-direction: column;
}

h1 {
  margin: 0 0 6px;
  font-size: 32px;
  letter-spacing: 0.6px;
  text-align: center;
}

.subtitle {
  opacity: 0.7;
  margin-bottom: 26px;
  text-align: center;
}

.links {
  margin-bottom: 30px;
  display: flex;
  gap: 20px;
  justify-content: center;
  flex-wrap: wrap;
}

.links a {
  padding: 12px 24px;
  background: rgba(196,30,58,0.2);
  border: 1px solid var(--accent);
  border-radius: 12px;
  color: #fff;
  text-decoration: none;
  font-weight: 600;
  transition: background 0.3s;
}

.links a:hover {
  background: rgba(196,30,58,0.4);
}

.links a.active {
  background: rgba(196,30,58,0.5);
  border-color: #fff;
  cursor: default;
}

.content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 40px;
  flex: 1;
}

.inputs {
  display: flex;
  flex-direction: column;
  gap: 18px;
}

.field {
  display: flex;
  flex-direction: column;
}

.field label {
  font-size: 13px;
  opacity: 0.8;
  margin-bottom: 8px;
}

.field input, .field select {
  width: 100%;
  padding: 18px 16px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: rgba(0,0,0,0.55);
  color: #fff;
  font-size: 18px;
  font-weight: 500;
}

.field input:focus, .field select:focus {
  outline: none;
  border-color: var(--accent);
}

.outputs {
  display: flex;
  flex-direction: column;
  gap: 30px;
}

.results {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px;
}

.result {
  background: rgba(0,0,0,0.5);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.result span {
  display: block;
  font-size: 13px;
  opacity: 0.7;
  margin-bottom: 8px;
}

.result strong {
  font-size: 28px;
  color: var(--accent);
}

.final-yield {
  grid-column: 1 / -1;
  background: rgba(196,30,58,0.2);
  border: 2px solid var(--accent);
  padding: 30px;
  font-size: 32px;
}

.chart-container {
  position: relative;
  height: 380px;
  background: rgba(0,0,0,0.5);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
}

.actions {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 20px;
}

.actions button {
  padding: 14px 28px;
  background: rgba(196,30,58,0.2);
  border: 1px solid var(--accent);
  border-radius: 12px;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s;
}

.actions button:hover {
  background: rgba(196,30,58,0.4);
}

.footer {
  margin-top: 30px;
  font-size: 11px;
  opacity: 0.5;
  text-align: right;
}

@media (max-width: 900px) {
  .content {
    grid-template-columns: 1fr;
  }
  .results {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<div class="panel" id="captureArea">
  <h1>Dinfar Brew Calc</h1>
  <div class="subtitle">Single compound steroid solution calculator</div>

  <div class="links">
    <a href="index.html" class="active">Single Compound</a>
    <a href="dinfarblend.html">Blend Calculator →</a>
  </div>

  <div class="content">
    <div class="inputs">
      <div class="field">
        <label>Compound</label>
        <select id="compound" onchange="updateDisplacement(); calc()">
          <option value="custom">Custom (manual displacement)</option>
          <option value="test-base">Testosterone Base</option>
          <option value="test-p">Testosterone Propionate</option>
          <option value="test-phenyl">Testosterone Phenylpropionate</option>
          <option value="test-c">Testosterone Cypionate</option>
          <option value="test-e">Testosterone Enanthate</option>
          <option value="test-iso">Testosterone Isocaproate</option>
          <option value="test-deca">Testosterone Decanoate</option>
          <option value="test-susp">Testosterone Suspension (water-based)</option>
          <option value="tren-a">Trenbolone Acetate</option>
          <option value="tren-e">Trenbolone Enanthate</option>
          <option value="tren-e">Trenbolone Hex</option>
          <option value="deca">Nandrolone Decanoate (Deca)</option>
          <option value="npp">Nandrolone Phenylpropionate (NPP)</option>
          <option value="eq">Boldenone Undecylenate (EQ)</option>
          <option value="bold-cyp">Boldenone Cypionate</option>
          <option value="masteron-p">Drostanolone Propionate (Masteron P)</option>
          <option value="masteron-e">Drostanolone Enanthate (Masteron E)</option>
          <option value="primo-e">Methenolone Enanthate (Primobolan)</option>
          <option value="trestolone">Trestolone (MENT)</option>
          <option value="trestolone-a">Trestolone Acetate</option>
          <option value="dhb">1-Testosterone Cypionate (DHB)</option>
          <option value="winstrol">Winstrol (Stanozolol) - Injectable</option>
          <option value="dbol">Dianabol (Methandrostenolone) - Injectable</option>
          <option value="anadrol">Anadrol (Oxymetholone) - Injectable</option>
          <option value="anavar">Anavar (Oxandrolone) - Injectable</option>
          <option value="tbol">Turinabol (Chlorodehydromethyltestosterone) - Injectable</option>
          <option value="sdrol">Superdrol (Methasterone) - Injectable</option>
          <option value="proviron">Proviron (Mesterolone) - Injectable</option>
          <option value="yk11">YK-11 - Injectable</option>
        </select>
      </div>

      <div class="field">
        <label>Desired Final Volume (ml)</label>
        <input id="totalVol" type="number" value="10" oninput="calc()">
      </div>

      <div class="field">
        <label>Concentration (mg/ml)</label>
        <input id="mgml" type="number" value="300" oninput="calc()">
      </div>

      <div class="field">
        <label>Displacement (ml/g)</label>
        <input id="disp" type="number" step="0.001" value="0.909" oninput="calc()">
      </div>

      <div class="field">
        <label>Purity (%)</label>
        <input id="purity" type="number" value="100" oninput="calc()">
      </div>

      <div class="field">
        <label>Sterile Filter Pore Size</label>
        <select id="filter" onchange="calc()">
          <option value="none">No Filter Loss Compensation</option>
          <option value="0.45">0.45µm (~0.8–1.2ml loss)</option>
          <option value="0.22">0.22µm (~1.2–2.0ml loss)</option>
          <option value="double">Double Filtration (0.45 + 0.22µm) (~2.0–3.0ml loss)</option>
          <option value="custom">Custom Loss (ml)</option>
        </select>
      </div>

      <div class="field" id="customLossField" style="display:none;">
        <label>Custom Filter Loss (ml)</label>
        <input id="customLoss" type="number" step="0.1" value="1.5" oninput="calc()">
      </div>

      <div class="field">
        <label>Benzyl Alcohol (BA) %</label>
        <input id="baPct" type="number" value="2" oninput="calc()">
      </div>

      <div class="field">
        <label>Benzyl Benzoate (BB) %</label>
        <input id="bbPct" type="number" value="15" oninput="calc()">
      </div>

      <div class="field">
        <label>Extra Solvent %</label>
        <input id="bcPct" type="number" value="0" oninput="calc()">
      </div>

      <div class="field">
        <label>Extra Solvent Type</label>
        <select id="extraSolvent" onchange="calc()">
          <option value="none">None / Oil filler</option>
          <option value="guaiacol">Guaiacol (1.129 g/ml)</option>
          <option value="eo">Ethyl Oleate (EO) (0.87 g/ml)</option>
          <option value="peg400">PEG 400 (1.128 g/ml)</option>
          <option value="dmso">DMSO (1.10 g/ml)</option>
          <option value="castor">Castor Oil (~0.96 g/ml)</option>
          <option value="gso">Grapeseed Oil (GSO) (~0.92 g/ml)</option>
          <option value="sesame">Sesame Oil (~0.92 g/ml)</option>
          <option value="mct">MCT Oil (~0.95 g/ml)</option>
          <option value="mig840">Miglyol 840 (~0.94 g/ml)</option>
          <option value="mig812">Miglyol 812N (0.95 g/ml)</option>
          <option value="eo">Ethyl Oleate (EO) (0.87 g/ml)</option>
          <option value="ethyl-lactate">Ethyl L-Lactate (1.035 g/ml)</option>
          <option value="custom">Custom (manual density)</option>
        </select>
      </div>

      <div class="field" id="customExtraField" style="display:none;">
        <label>Custom Extra Density (g/ml)</label>
        <input id="customExtraDensity" type="number" step="0.001" value="1.1" oninput="calc()">
      </div>

      <div class="field">
        <label>Carrier Oil / Solvent</label>
        <select id="oil" onchange="calc()">
          <option value="castor">Castor Oil (~0.96 g/ml)</option>
          <option value="gso">Grapeseed Oil (GSO) (~0.92 g/ml)</option>
          <option value="sesame">Sesame Oil (~0.92 g/ml)</option>
          <option value="mct">MCT Oil (~0.95 g/ml)</option>
          <option value="mig840">Miglyol 840 (~0.94 g/ml)</option>
          <option value="mig812">Miglyol 812N (0.95 g/ml)</option>
          <option value="eo">Ethyl Oleate (EO) (0.87 g/ml)</option>
          <option value="ethyl-lactate">Ethyl L-Lactate (1.035 g/ml)</option>
          <option value="custom">Custom (manual density)</option>
        </select>
      </div>

      <div class="field" id="customOilField" style="display:none;">
        <label>Custom Carrier Density (g/ml)</label>
        <input id="customOilDensity" type="number" step="0.001" value="0.92" oninput="calc()">
      </div>
    </div>

    <div class="outputs">
      <div class="results">
        <!-- Left: What you add to the brew -->
        <div class="result">
          <span>Powder Weight</span>
          <strong id="powder">0 g</strong>
        </div>
        <div class="result">
          <span>BA Volume</span>
          <strong id="baVol">0 ml</strong>
        </div>
        <div class="result">
          <span>BA Weight</span>
          <strong id="baWeight">0 g</strong>
        </div>
        <div class="result">
          <span>BB Volume</span>
          <strong id="bbVol">0 ml</strong>
        </div>
        <div class="result">
          <span>BB Weight</span>
          <strong id="bbWeight">0 g</strong>
        </div>
        <div class="result">
          <span>Extra Solvent Volume</span>
          <strong id="bcVol">0 ml</strong>
        </div>
        <div class="result">
          <span>Extra Solvent Weight</span>
          <strong id="bcWeight">0 g</strong>
        </div>
        <div class="result">
          <span>Carrier Volume</span>
          <strong id="oilVol">0 ml</strong>
        </div>
        <div class="result">
          <span>Carrier Weight</span>
          <strong id="oilWeight">0 g</strong>
        </div>

        <!-- Right: Info -->
        <div class="result">
          <span>Compound Volume</span>
          <strong id="compoundVol">0 ml</strong>
        </div>
        <div class="result">
          <span>Total Brew Volume</span>
          <strong id="totalBrew">0 ml</strong>
        </div>
        <div class="result">
          <span>Volume Check</span>
          <strong id="checkVol">0 ml</strong>
        </div>

        <!-- Final Yield - Full width, only once -->
        <div class="result final-yield">
          <span>Final Yield</span>
          <strong id="finalYield">0 ml</strong>
        </div>
      </div>

      <div class="chart-container">
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </div>

  <div class="actions">
    <button onclick="downloadPDF()">Download as PDF</button>
    <button onclick="downloadDOCX()">Download as DOCX</button>
    <button onclick="goToBlend()">Go to Blend Calc</button>
  </div>
</div>

<div class="footer">
  Dinfar Brew ©
</div>

<script>
const displacements = {
  "custom": 0.909,
  "test-base": 0.909,
  "test-p": 0.916,
  "test-phenyl": 0.954,
  "test-c": 0.909,
  "test-e": 0.943,
  "test-iso": 0.935,
  "test-deca": 0.962,
  "test-susp": 1.000,
  "test-undecanoate": 0.97,
  "tren-a": 0.848,
  "tren-e": 0.909,
  "tren-hex": 0.909,
  "nandrolone-base": 0.89,
  "deca": 0.962,
  "npp": 0.877,
  "eq": 0.952,
  "bold-cyp": 0.909,
  "masteron-p": 0.935,
  "masteron-e": 0.962,
  "primo-e": 0.952,
  "trestolone": 0.900,
  "trestolone-a": 0.901,
  "dhb": 0.97,
  "winstrol": 0.885,
  "dbol": 0.892,
  "anadrol": 0.86,
  "anavar": 0.9,
  "tbol": 0.83,
  "sdrol": 0.909,
  "proviron": 0.909,
  "yk11": 0.820
};

const densities = {
  ba: 1.044,
  bb: 1.118,
  castor: 0.96,
  gso: 0.92,
  sesame: 0.92,
  mct: 0.95,
  mig840: 0.94,
  mig812: 0.95,
  eo: 0.87,
  'ethyl-lactate': 1.035,
  guaiacol: 1.129,
  peg400: 1.128,
  dmso: 1.10,
  none: 1.0
};

let chart;

function updateDisplacement() {
  const select = document.getElementById('compound');
  const dispInput = document.getElementById('disp');
  const selected = select.value;
  
  if (selected !== "custom") {
    dispInput.value = displacements[selected].toFixed(3);
  }
  calc();
}

function showCustomFields() {
  const filter = document.getElementById('filter').value;
  document.getElementById('customLossField').style.display = filter === 'custom' ? 'block' : 'none';

  const extra = document.getElementById('extraSolvent').value;
  document.getElementById('customExtraField').style.display = extra === 'custom' ? 'block' : 'none';

  const oil = document.getElementById('oil').value;
  document.getElementById('customOilField').style.display = oil === 'custom' ? 'block' : 'none';
}

function goToBlend() {
  const recipe = {
    totalVol: document.getElementById('totalVol').value,
    mgml1: document.getElementById('mgml').value,
    disp1: document.getElementById('disp').value,
    purity1: document.getElementById('purity').value,
    baPct: document.getElementById('baPct').value,
    bbPct: document.getElementById('bbPct').value,
    extraPct: document.getElementById('bcPct').value
  };
  localStorage.setItem('importedSingleToBlend', JSON.stringify(recipe));
  window.location.href = 'dinfarblend.html';
}



function calc() {
  showCustomFields();

  const desiredVol = parseFloat(document.getElementById('totalVol').value) || 0;
  const conc = parseFloat(document.getElementById('mgml').value) || 0;
  const disp = parseFloat(document.getElementById('disp').value) || 0;
  const purity = parseFloat(document.getElementById('purity').value) || 100;

  const baPct = parseFloat(document.getElementById('baPct').value) || 0;
  const bbPct = parseFloat(document.getElementById('bbPct').value) || 0;
  const extraPct = parseFloat(document.getElementById('bcPct').value) || 0;

  const filterType = document.getElementById('filter').value;
  let filterLoss = 0;
  if (filterType === '0.45') filterLoss = 1.0;
  else if (filterType === '0.22') filterLoss = 1.6;
  else if (filterType === 'double') filterLoss = 2.5;
  else if (filterType === 'custom') filterLoss = parseFloat(document.getElementById('customLoss').value) || 0;

  const extraType = document.getElementById('extraSolvent').value;
  let extraDensity = densities[extraType] || 1.0;
  if (extraType === 'custom') extraDensity = parseFloat(document.getElementById('customExtraDensity').value) || 1.0;

  const oilType = document.getElementById('oil').value;
  let oilDensity = densities[oilType] || 0.92;
  if (oilType === 'custom') oilDensity = parseFloat(document.getElementById('customOilDensity').value) || 0.92;

  const totalBrewVol = desiredVol + filterLoss;

  let powder = (totalBrewVol * conc / 1000) / (purity / 100);
  powder = conc > 0 ? powder : 0;

  const compoundVol = powder * disp;

  const baVol = totalBrewVol * (baPct / 100);
  const bbVol = totalBrewVol * (bbPct / 100);
  const extraVol = totalBrewVol * (extraPct / 100);

  const oilVol = totalBrewVol - compoundVol - baVol - bbVol - extraVol;

  const check = compoundVol + baVol + bbVol + extraVol + oilVol;

  const baWeight = baVol * densities.ba;
  const bbWeight = bbVol * densities.bb;
  const extraWeight = extraVol * extraDensity;
  const oilWeight = oilVol * oilDensity;

  document.getElementById('powder').textContent = powder.toFixed(3) + ' g';
  document.getElementById('compoundVol').textContent = compoundVol.toFixed(3) + ' ml';
  document.getElementById('baVol').textContent = baVol.toFixed(2) + ' ml';
  document.getElementById('baWeight').textContent = baWeight.toFixed(3) + ' g';
  document.getElementById('bbVol').textContent = bbVol.toFixed(2) + ' ml';
  document.getElementById('bbWeight').textContent = bbWeight.toFixed(3) + ' g';
  document.getElementById('bcVol').textContent = extraVol.toFixed(2) + ' ml';
  document.getElementById('bcWeight').textContent = extraWeight.toFixed(3) + ' g';
  document.getElementById('oilVol').textContent = oilVol.toFixed(2) + ' ml';
  document.getElementById('oilWeight').textContent = oilWeight.toFixed(3) + ' g';
  document.getElementById('totalBrew').textContent = totalBrewVol.toFixed(2) + ' ml';
  document.getElementById('finalYield').textContent = desiredVol.toFixed(2) + ' ml';
  document.getElementById('checkVol').textContent = check.toFixed(2) + ' ml';

  const ctx = document.getElementById('pieChart').getContext('2d');
  const data = [compoundVol, baVol, bbVol, extraVol, oilVol];
  const labels = ['Compound', 'BA', 'BB', 'Extra Solvent', 'Carrier'];
  const colors = ['#c41e3a', '#e91e63', '#ff9800', '#ffeb3b', '#4caf50'];

  const filteredData = [];
  const filteredLabels = [];
  const filteredColors = [];
  data.forEach((val, i) => {
    if (val > 0.01) {
      filteredData.push(val);
      filteredLabels.push(labels[i]);
      filteredColors.push(colors[i]);
    }
  });

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: filteredLabels,
      datasets: [{
        data: filteredData,
        backgroundColor: filteredColors,
        borderColor: '#111',
        borderWidth: 3,
        hoverBorderWidth: 5
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '65%',
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: '#fff',
            font: { size: 15 },
            padding: 20,
            usePointStyle: true
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const value = context.parsed;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((value / total) * 100).toFixed(1);
              return `${context.label}: ${value.toFixed(3)} ml (${percentage}%)`;
            }
          }
        }
      }
    }
  });
}

updateDisplacement();
calc();
document.getElementById('filter').addEventListener('change', calc);
document.getElementById('extraSolvent').addEventListener('change', calc);
document.getElementById('oil').addEventListener('change', calc);
</script>

</body>
</html>


