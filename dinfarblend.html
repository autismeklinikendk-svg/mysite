<!-- dinfarblend.html (Blend Calculator - Final Version) -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dinfar Blend Calc</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<!-- Same <style> block as dinfarcalc.html -->

</head>
<body>

<div class="panel" id="captureArea">
  <h1>Dinfar Blend Calc</h1>
  <div class="subtitle">Blend steroid solution calculator (up to 3 compounds)</div>

  <div class="links">
    <a href="dinfarcalc.html">Single Compound</a>
    <a href="dinfarblend.html" class="active">Blend Calculator</a>
    <a href="dinfaroverdose.html">Overdose Calculator →</a>
  </div>

  <div class="content">
    <div class="inputs">
      <div class="field">
        <label>Desired Final Volume (ml)</label>
        <input id="totalVol" type="number" value="10" oninput="calc()">
      </div>

      <div class="field">
        <label>Sterile Filter Pore Size</label>
        <select id="filter" onchange="calc()">
          <option value="none">No Filter Loss Compensation</option>
          <option value="0.45">0.45µm (~0.8–1.2ml loss)</option>
          <option value="0.22">0.22µm (~1.2–2.0ml loss)</option>
          <option value="double">Double Filtration (0.45 + 0.22µm) (~2.0–3.0ml loss)</option>
          <option value="custom">Custom Loss (ml)</option>
        </select>
      </div>

      <div class="field" id="customLossField" style="display:none;">
        <label>Custom Filter Loss (ml)</label>
        <input id="customLoss" type="number" step="0.1" value="1.5" oninput="calc()">
      </div>

      <!-- Compound 1 -->
      <div class="field">
        <label>Compound 1</label>
        <select id="compound1" onchange="updateDisplacement(1); calc()">
          <!-- same full option list as single -->
        </select>
      </div>
      <div class="field">
        <label>Compound 1 Conc (mg/ml)</label>
        <input id="mgml1" type="number" value="150" oninput="calc()">
      </div>
      <div class="field">
        <label>Compound 1 Displacement (ml/g)</label>
        <input id="disp1" type="number" step="0.001" value="0.909" oninput="calc()">
      </div>
      <div class="field">
        <label>Compound 1 Purity (%)</label>
        <input id="purity1" type="number" value="100" oninput="calc()">
      </div>

      <!-- Compound 2 -->
      <div class="field">
        <label>Compound 2</label>
        <select id="compound2" onchange="updateDisplacement(2); calc()">
          <!-- same full option list -->
        </select>
      </div>
      <div class="field">
        <label>Compound 2 Conc (mg/ml)</label>
        <input id="mgml2" type="number" value="150" oninput="calc()">
      </div>
      <div class="field">
        <label>Compound 2 Displacement (ml/g)</label>
        <input id="disp2" type="number" step="0.001" value="0.909" oninput="calc()">
      </div>
      <div class="field">
        <label>Compound 2 Purity (%)</label>
        <input id="purity2" type="number" value="100" oninput="calc()">
      </div>

      <!-- Compound 3 -->
      <div class="field">
        <label>Compound 3</label>
        <select id="compound3" onchange="updateDisplacement(3); calc()">
          <!-- same full option list -->
        </select>
      </div>
      <div class="field">
        <label>Compound 3 Conc (mg/ml)</label>
        <input id="mgml3" type="number" value="0" oninput="calc()">
      </div>
      <div class="field">
        <label>Compound 3 Displacement (ml/g)</label>
        <input id="disp3" type="number" step="0.001" value="0.909" oninput="calc()">
      </div>
      <div class="field">
        <label>Compound 3 Purity (%)</label>
        <input id="purity3" type="number" value="100" oninput="calc()">
      </div>

      <!-- Solvents -->
      <div class="field">
        <label>Benzyl Alcohol (BA) %</label>
        <input id="baPct" type="number" value="2" oninput="calc()">
      </div>
      <div class="field">
        <label>Benzyl Benzoate (BB) %</label>
        <input id="bbPct" type="number" value="15" oninput="calc()">
      </div>
      <div class="field">
        <label>Extra Solvent %</label>
        <input id="bcPct" type="number" value="0" oninput="calc()">
      </div>
      <div class="field">
        <label>Extra Solvent Type</label>
        <select id="extraSolvent" onchange="calc()">
          <!-- same as single -->
        </select>
      </div>
      <div class="field" id="customExtraField" style="display:none;">
        <label>Custom Extra Density (g/ml)</label>
        <input id="customExtraDensity" type="number" step="0.001" value="1.1" oninput="calc()">
      </div>
      <div class="field">
        <label>Carrier Oil / Solvent</label>
        <select id="oil" onchange="calc()">
          <!-- same as single -->
        </select>
      </div>
      <div class="field" id="customOilField" style="display:none;">
        <label>Custom Carrier Density (g/ml)</label>
        <input id="customOilDensity" type="number" step="0.001" value="0.92" oninput="calc()">
      </div>
    </div>

    <div class="outputs">
      <div class="results">
        <div class="result">
          <span>Compound 1 Powder</span>
          <strong id="powder1">0 g</strong>
        </div>
        <div class="result">
          <span>Compound 2 Powder</span>
          <strong id="powder2">0 g</strong>
        </div>
        <div class="result">
          <span>Compound 3 Powder</span>
          <strong id="powder3">0 g</strong>
        </div>

        <div class="result">
          <span>Total Compound Volume</span>
          <strong id="compoundVol">0 ml</strong>
        </div>
        <div class="result">
          <span>BA Volume</span>
          <strong id="baVol">0 ml</strong>
        </div>
        <div class="result">
          <span>BA Weight</span>
          <strong id="baWeight">0 g</strong>
        </div>

        <div class="result">
          <span>BB Volume</span>
          <strong id="bbVol">0 ml</strong>
        </div>
        <div class="result">
          <span>BB Weight</span>
          <strong id="bbWeight">0 g</strong>
        </div>
        <div class="result">
          <span>Extra Solvent Volume</span>
          <strong id="bcVol">0 ml</strong>
        </div>

        <div class="result">
          <span>Extra Solvent Weight</span>
          <strong id="bcWeight">0 g</strong>
        </div>
        <div class="result">
          <span>Carrier Volume</span>
          <strong id="oilVol">0 ml</strong>
        </div>
        <div class="result">
          <span>Carrier Weight</span>
          <strong id="oilWeight">0 g</strong>
        </div>

        <div class="result">
          <span>Total Brew Volume</span>
          <strong id="totalBrew">0 ml</strong>
        </div>
        <div class="result">
          <span>Final Yield</span>
          <strong id="finalYield">0 ml</strong>
        </div>
        <div class="result">
          <span>Volume Check</span>
          <strong id="checkVol">0 ml</strong>
        </div>
      </div>

      <div class="chart-container">
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </div>

  <div class="actions">
    <button onclick="downloadPDF()">Download as PDF</button>
    <button onclick="downloadDOCX()">Download as DOCX</button>
    <button onclick="goToSingle()">Go to Single Calc</button>
    <button onclick="goToOverdose()">Go to Overdose Calc</button>
  </div>
</div>

<div class="footer">
  Dinfar Brew ©
</div>

<script>
/* Same displacements and densities objects as single calc */

function updateDisplacement(num) {
  const select = document.getElementById(`compound${num}`);
  const dispInput = document.getElementById(`disp${num}`);
  const selected = select.value;
  
  if (selected !== "custom") {
    dispInput.value = displacements[selected].toFixed(3);
  }
  calc();
}

/* showCustomFields, calc (adapted for 3 compounds + weights), goToSingle, goToOverdose, downloadPDF/DOCX same as previous blend version */

updateDisplacement(1);
updateDisplacement(2);
updateDisplacement(3);
calc();
document.getElementById('filter').addEventListener('change', calc);
document.getElementById('extraSolvent').addEventListener('change', calc);
document.getElementById('oil').addEventListener('change', calc);
</script>

</body>
</html>
